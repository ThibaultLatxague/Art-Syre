<!-- register.component.html -->
<div class="register-container">
    <mat-card class="register-card">
        <mat-card-header>
            <mat-card-title>Inscription</mat-card-title>
            <mat-card-subtitle>Créez votre compte</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
            <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">

                <!-- Nom -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Nom</mat-label>
                    <input matInput
                        formControlName="nom"
                        placeholder="Votre nom"
                        autocomplete="family-name">
                    <mat-error
                        *ngIf="registerForm.get('nom')?.hasError('required')">
                        Le nom est obligatoire
                    </mat-error>
                    <mat-error
                        *ngIf="registerForm.get('nom')?.hasError('minlength')">
                        Le nom doit contenir au moins 2 caractères
                    </mat-error>
                    <mat-error
                        *ngIf="registerForm.get('nom')?.hasError('pattern')">
                        Le nom ne doit contenir que des lettres
                    </mat-error>
                </mat-form-field>

                <!-- Prénom -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Prénom</mat-label>
                    <input matInput
                        formControlName="prenom"
                        placeholder="Votre prénom"
                        autocomplete="given-name">
                    <mat-error
                        *ngIf="registerForm.get('prenom')?.hasError('required')">
                        Le prénom est obligatoire
                    </mat-error>
                    <mat-error
                        *ngIf="registerForm.get('prenom')?.hasError('minlength')">
                        Le prénom doit contenir au moins 2 caractères
                    </mat-error>
                    <mat-error
                        *ngIf="registerForm.get('prenom')?.hasError('pattern')">
                        Le prénom ne doit contenir que des lettres
                    </mat-error>
                </mat-form-field>

                <!-- Email -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Adresse email</mat-label>
                    <input matInput
                        formControlName="email"
                        placeholder="votre@email.com"
                        type="email"
                        autocomplete="email">
                    <mat-error
                        *ngIf="registerForm.get('email')?.hasError('required')">
                        L'adresse email est obligatoire
                    </mat-error>
                    <mat-error
                        *ngIf="registerForm.get('email')?.hasError('email')">
                        Veuillez saisir une adresse email valide
                    </mat-error>
                    <mat-error
                        *ngIf="registerForm.get('email')?.hasError('emailExists')">
                        Cette adresse email est déjà utilisée
                    </mat-error>
                    <mat-icon matSuffix>email</mat-icon>
                </mat-form-field>

                <!-- Mot de passe -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Mot de passe</mat-label>
                    <input matInput
                        formControlName="motDePasse"
                        [type]="hidePassword ? 'password' : 'text'"
                        placeholder="Votre mot de passe"
                        autocomplete="new-password">
                    <button mat-icon-button
                        matSuffix
                        type="button"
                        (click)="hidePassword = !hidePassword"
                        [attr.aria-label]="'Hide password'"
                        [attr.aria-pressed]="hidePassword">
                        <mat-icon>{{hidePassword ? 'visibility_off' :
                            'visibility'}}</mat-icon>
                    </button>
                    <mat-error
                        *ngIf="registerForm.get('motDePasse')?.hasError('required')">
                        Le mot de passe est obligatoire
                    </mat-error>
                    <mat-error
                        *ngIf="registerForm.get('motDePasse')?.hasError('minlength')">
                        Le mot de passe doit contenir au moins 8 caractères
                    </mat-error>
                    <mat-error
                        *ngIf="registerForm.get('motDePasse')?.hasError('passwordStrength')">
                        Le mot de passe doit contenir au moins une majuscule,
                        une minuscule, un chiffre et un caractère spécial
                    </mat-error>
                </mat-form-field>

                <!-- Indicateur de force du mot de passe -->
                <div class="password-strength"
                    *ngIf="registerForm.get('motDePasse')?.value">
                    <div class="strength-indicator">
                        <div class="strength-bar"
                            [ngClass]="passwordStrength.class"></div>
                    </div>
                    <span class="strength-text"
                        [ngStyle]="{'color': passwordStrength.color}">
                        {{passwordStrength.text}}
                    </span>
                </div>

                <!-- Confirmation mot de passe -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Confirmer le mot de passe</mat-label>
                    <input matInput
                        formControlName="confirmMotDePasse"
                        [type]="hideConfirmPassword ? 'password' : 'text'"
                        placeholder="Confirmez votre mot de passe"
                        autocomplete="new-password">
                    <button mat-icon-button
                        matSuffix
                        type="button"
                        (click)="hideConfirmPassword = !hideConfirmPassword"
                        [attr.aria-label]="'Hide password'"
                        [attr.aria-pressed]="hideConfirmPassword">
                        <mat-icon>{{hideConfirmPassword ? 'visibility_off' :
                            'visibility'}}</mat-icon>
                    </button>
                    <mat-error
                        *ngIf="registerForm.get('confirmMotDePasse')?.hasError('required')">
                        La confirmation du mot de passe est obligatoire
                    </mat-error>
                    <mat-error
                        *ngIf="registerForm.get('confirmMotDePasse')?.hasError('passwordMismatch')">
                        Les mots de passe ne correspondent pas
                    </mat-error>
                </mat-form-field>

                <!-- Loading spinner -->
                <div class="loading-container" *ngIf="isLoading">
                    <mat-spinner diameter="30"></mat-spinner>
                    <span>Création du compte en cours...</span>
                </div>

                <!-- Boutons -->
                <div class="button-container">
                    <button mat-raised-button
                        color="secondary"
                        type="submit"
                        [disabled]="registerForm.invalid || isLoading"
                        class="submit-button">
                        <mat-icon>person_add</mat-icon>
                        Créer le compte
                    </button>

                    <button mat-button
                        type="button"
                        (click)="resetForm()"
                        [disabled]="isLoading">
                        Réinitialiser
                    </button>
                </div>

                <!-- Lien de connexion -->
                <div class="login-link">
                    <p>Vous avez déjà un compte ?
                        <a mat-button color="primary" routerLink="/login">Se
                            connecter</a>
                    </p>
                </div>

            </form>
        </mat-card-content>
    </mat-card>
</div>